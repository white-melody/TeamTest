/**
 * 
 */
package egovframework.example.auth.web;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;

import egovframework.example.auth.service.MemberService;
import egovframework.example.auth.service.MemberVO;

/**
 * @author user
 *
 */
@Controller
public class MemberController {
   @Autowired
   private MemberService memberService;
   
//   로그인 화면 열기
   @GetMapping("/login.do")
   public String loginView() {
      return "auth/login";
   }
   
//   로그인 처리: 보안목적(@PostMapping 사용)
//   @GetMapping: 1) 조회(로그인도) => id, 암호(주소창에 표시)
//   @PostMapping: 2) 입력/수정/삭제 => id, 암호(주소창에 표시안됨)
   @PostMapping("/loginProcess.do")
   public String login(HttpSession session, 
         @ModelAttribute MemberVO loginVO) throws Exception {
//      1) DB에 입력된유저가 있는지 확인: 서비스의 로그인메소드 실행
      MemberVO memberVO=memberService.authenticate(loginVO);
//      2) 세션을 만듭니다.: 유저저장(세션: 정보를 임시로 저장하는 공간:서버컴퓨터에(스프링) 저장)
//      사용법: 세션.setAttribute("키", 값);
      session.setAttribute("memberVO", memberVO);
//          (DB(영구적) vs 세션(임시:컴퓨터 재시작(사라짐), 웹브라우저를 꺼도 사라짐)
//      3) 통과: 이동할페이지 강제이동
      return "redirect:/";
   }
   
//	로그아웃 처리
	@GetMapping("/logout.do")
	public String logout(HttpSession session) {
//		세션 전체 삭제:
		session.invalidate();
		return "redirect:/login.do";
	}
}






